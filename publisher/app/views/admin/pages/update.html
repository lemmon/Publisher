{% extends 'admin/_templates/form.html' %}

{% block title %}{{ item.name }}{% endblock %}

{% block form_primary %}
<fieldset>
	
	{{ forms.p('name', flash, {'class': 'fit'}) }}
		{{ forms.label('name', null, 'required') }}
		{{ forms.input('name', f.name) }}
	</p>

	<p class="fit">
		{{ forms.label('content', null, 'recommended') }}
		{{ forms.text('content', f.content) }}
	</p>
	
</fieldset>
{% endblock %}

{% block form_secondary %}
<fieldset>

	{{ forms.p('state_id', flash) }}
		{{ forms.label('state_id', null, 'required') }}
		<span class="fieldset">
		{{ forms.radio_collection('state_id', f.state_id is defined ? f.state_id : false, item.optionsForState) }}
		</span>
	</p>

	{{ forms.p('locale', flash) }}
		{{ forms.label('locale', null, 'required') }}
		{{ forms.select_groups('locale', f.locale, locales) }}
	</p>

	<p class="fit">
		{{ forms.label('parent_id', null, 'optional') }}
		<span class="fieldset" id="f_parent_id">
			
			<label><input type="radio" name="parent_id" value="" {% if (not f.parent_id) %}checked{% endif %}> <em>{{ 'root page'|t }}</em></label>
			<strong id="parent_id_thispage"><img src="{{ link.publisher('admin/img/subpath.png') }}"> {{ "This Page"|t }}<br></strong>
			
			{% for _locale, _pages in pages.langs %}
			<span class="locale-{{ _locale }}">
				{% include '_form_listpages.html' with {'_pages': pages.langs[_locale]} %}
			</span>
			{% endfor %}
			
		<span>
	</p>
	
	<p class="fit">
		{{ forms.label('top', null, 'optional') }}
		{{ forms.input('top', f.top) }}
	</p>
	
	<p class="fit">
		{{ forms.label('template', null, 'optional') }}
		{{ forms.input('template', f.template) }}
	</p>
	
</fieldset>
{% endblock %}

{% block form_buttons %}
<button class="primary" type="submit">{{ "Update page"|t }}</button>
<a class="back" href="{{ link.returnTo(":section") }}">{{ "back"|t }}</a>
{% endblock %}

{% block rail %}

	{% include '_sidebar.html' %}

{% endblock %}

{% block script %}
<style>
#f_parent_id label {
	display:block;
	position:relative;
}
#parent_id_thispage {
	color:#000000;
	display:block;
	font-style:italic;
	font-weight:600;
	line-height:1px;
}
#parent_id_thispage img {
	display:inline-block;
	margin:0 2px 0 0;
	vertical-align:middle;
}
#f_parent_id > span label input[type=radio] {
	position:absolute;
	left:-19px;
	top:8px;
	margin:0;
	border:0;
}
</style>
<script>
$(function(){
	
	//
	// locales
	var $thispage = $('#parent_id_thispage');
	var languages = {
		{% for _group in locales %}
		{% if (loop.index0) %},{% endif -%}
		{% for _l in _group.data %}
		{% if (loop.index0) %},{% endif -%}
		{{ _l.id }}: {code: '{{ _l.country.code|lower }}'}
		{% endfor %}
		{% endfor %}
	};
	
	function format(state){
		if (state.id){
			return '<i class="flag" style="background:url(' + '{{ link.vendor('flags/@code.png') }}'.replace('@code', languages[state.id].code) + ')"></i>' + state.text;
		} else{
			if (state.text)
				return '<strong>' + state.text + '</strong>';
		}
	}
	
	$('#f_parent_id').find('span').filter(':not(.locale-' + $('#f_locale').val() + ')').hide();
	$('#f_locale').select2({
		width: '100%',
		formatResult: format,
		formatSelection: format
	}).on('change', function(e){
		$('#f_parent_id').find('span').filter('.locale-' + e.val).show();
		$('#f_parent_id').find('span').filter(':not(.locale-' + e.val + ')').hide();
		$('#f_parent_id').find('input:first').click();
	});
	
	//
	// parent
	$('#f_parent_id').find('input').click(function(){
		var $label = $(this).parent();
		$thispage.insertAfter($label).css('margin-left', $label.css('margin-left'));
	}).filter(':checked').click();
	
})
</script>
{% include '_tinymce.html' %}
{% endblock %}

